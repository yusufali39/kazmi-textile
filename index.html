<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice Generator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        padding: 20px;
      }
      table input {
        width: 100%;
        border: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Invoice Generator</h2>
      <div class="row mb-3">
        <div class="col">
          <label>Customer Name</label>
          <input type="text" id="customer-name" class="form-control" />
        </div>
        <div class="col">
          <label>Customer Number</label>
          <input type="text" id="customer-number" class="form-control" />
        </div>
      </div>
      <table class="table table-bordered" id="invoice-table">
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Rate</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" class="item-name" /></td>
            <td><input type="number" class="item-qty" /></td>
            <td><input type="number" class="item-rate" /></td>
            <td><input type="number" class="item-amount" readonly /></td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-primary" id="add-row">Add Row</button>
      <hr />
      <button class="btn btn-success" id="generate-invoice">
        Generate Invoice
      </button>
      <button class="btn btn-success" id="generate-whatsapp">
        <i class="fab fa-whatsapp"></i> WhatsApp
      </button>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      let customerName = "";
      let customerNumber = "";

      $(document).ready(function () {
        // Save customer name & number automatically
        $("#customer-name").on("input", function () {
          customerName = $(this).val();
          localStorage.setItem("customerName", customerName);
        });

        $("#customer-number").on("input", function () {
          customerNumber = $(this).val();
          localStorage.setItem("customerNumber", customerNumber);
        });

        // Add new row
        $("#add-row").on("click", function () {
          $("#invoice-table tbody").append(`
            <tr>
              <td><input type="text" class="item-name" /></td>
              <td><input type="number" class="item-qty" /></td>
              <td><input type="number" class="item-rate" /></td>
              <td><input type="number" class="item-amount" readonly /></td>
            </tr>
          `);
        });

        // Auto-calc amount
        $(document).on("input", ".item-qty, .item-rate", function () {
          let row = $(this).closest("tr");
          let qty = parseFloat(row.find(".item-qty").val()) || 0;
          let rate = parseFloat(row.find(".item-rate").val()) || 0;
          row.find(".item-amount").val(qty * rate);
        });

        // Generate Invoice
        $("#generate-invoice").on("click", function () {
          alert("Invoice generated!");
        });

        // WhatsApp Bill
        $("#generate-whatsapp").on("click", function () {
          if (!customerNumber) {
            alert(
              "Please provide a customer number to send the bill via WhatsApp."
            );
            return;
          }

          let totalQty = 0;
          let totalAmount = 0;
          let billDetails = `Hi ${customerName},\n\nYour Invoice:\n`;

          $("#invoice-table tbody tr").each(function () {
            let item = $(this).find(".item-name").val();
            let qty = parseFloat($(this).find(".item-qty").val()) || 0;
            let rate = parseFloat($(this).find(".item-rate").val()) || 0;
            let amt = qty * rate;

            if (item && qty && rate) {
              billDetails += `${item} - Qty: ${qty}, Rate: ₹${rate}, Amt: ₹${amt}\n`;
              totalQty += qty;
              totalAmount += amt;
            }
          });

          billDetails += `\nTotal Qty: ${totalQty}\nTotal Amount: ₹${totalAmount}\nThank you for shopping with us!`;

          let whatsappUrl = `https://api.whatsapp.com/send?phone=${customerNumber}&text=${encodeURIComponent(
            billDetails
          )}`;
          window.open(whatsappUrl, "_blank");
        });
      });
    </script>
  </body>
</html>
